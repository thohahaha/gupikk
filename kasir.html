<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kasir - gupikkk POS</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <i class="ri-shopping-cart-line"></i>
        <span>gupikkk POS</span>
      </div>
      <button class="sidebar-toggle" id="sidebarToggle">
        <i class="ri-menu-fold-line"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul>
        <li class="nav-item active" data-page="cashier">
          <i class="ri-cash-line"></i>
          <span>Kasir</span>
        </li>
        <li class="nav-item" data-page="transactions">
          <i class="ri-file-list-line"></i>
          <span>Riwayat Transaksi</span>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">
          <i class="ri-user-3-line"></i>
        </div>
        <div class="user-detail">
          <span class="user-name" id="userName">Kasir</span>
          <span class="user-role">Kasir</span>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="logout()" style="width: 100%; margin-top: 1rem;">
        <i class="ri-logout-box-line"></i> Keluar
      </button>
    </div>
  </aside>

  <!-- Mobile Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <!-- Top Bar -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i class="ri-menu-line"></i>
        </button>
        <div class="page-title">
          <h1 id="pageTitle">Point of Sale</h1>
          <p id="pageSubtitle">Selamat datang di sistem kasir</p>
        </div>
      </div>
      <div class="topbar-right">
        <div class="search-box">
          <i class="ri-search-line"></i>
          <input type="text" id="productSearch" placeholder="Cari produk..." />
        </div>
        <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
          <i class="ri-moon-line"></i>
        </button>
      </div>
    </header>

    <!-- Cashier Page -->
    <section class="page active" id="page-cashier">
      <!-- Input Nama Kasir -->
      <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-body">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <label for="cashierName" style="font-weight: 600; min-width: 120px;">
              <i class="ri-user-line"></i> Nama Kasir:
            </label>
            <input 
              type="text" 
              id="cashierName" 
              class="form-input" 
              placeholder="Masukkan nama kasir" 
              style="flex: 1; max-width: 300px;"
              required
            />
            <span style="font-size: 0.9rem; color: #78716c;">
              <i class="ri-information-line"></i> Wajib diisi sebelum transaksi
            </span>
          </div>
        </div>
      </div>

      <div class="dashboard-grid" style="grid-template-columns: 1.5fr 1fr; gap: 1.5rem;">
        
        <!-- Product List -->
        <div class="card" style="height: calc(100vh - 200px);">
          <div class="card-header">
            <h3><i class="ri-box-3-line"></i> Daftar Produk</h3>
            <select id="categoryFilter" class="form-select" style="max-width: 200px;">
              <option value="">Semua Kategori</option>
            </select>
          </div>
          <div class="card-body" style="padding: 0; overflow-y: auto; max-height: calc(100vh - 280px);">
            <div id="productGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; padding: 1.5rem;">
              <!-- Products will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Cart & Checkout -->
        <div class="card" style="height: calc(100vh - 200px); display: flex; flex-direction: column;">
          <div class="card-header">
            <h3><i class="ri-shopping-basket-line"></i> Keranjang</h3>
            <button class="btn-icon danger" onclick="clearCart()" title="Kosongkan Keranjang">
              <i class="ri-delete-bin-line"></i>
            </button>
          </div>
          
          <!-- Cart Items -->
          <div class="card-body" style="flex: 1; overflow-y: auto; padding: 0;">
            <div id="cartItems" style="padding: 1.5rem;">
              <div class="empty-state small">
                <i class="ri-shopping-cart-line"></i>
                <p>Keranjang kosong</p>
              </div>
            </div>
          </div>

          <!-- Total & Checkout -->
          <div style="border-top: 2px solid #e7e5e4; padding: 1.5rem; background: #fafaf9;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 1.1rem;">
              <span style="font-weight: 600;">Total Items:</span>
              <span id="totalItems" style="font-weight: 700;">0</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 1.5rem;">
              <span style="font-weight: 700;">Total:</span>
              <span id="totalPrice" style="font-weight: 800; color: #0f766e;">Rp 0</span>
            </div>
            
            <!-- Input Jumlah Uang -->
            <div style="margin-bottom: 1rem; padding-top: 1rem; border-top: 1px solid #e7e5e4;">
              <label for="cashAmount" style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                <i class="ri-money-dollar-circle-line"></i> Jumlah Uang:
              </label>
              <input 
                type="number" 
                id="cashAmount" 
                class="form-input" 
                placeholder="0" 
                min="0"
                style="width: 100%; font-size: 1.2rem; font-weight: 600; text-align: right;"
                oninput="kasirApp.calculateChange()"
              />
            </div>

            <!-- Kembalian -->
            <div id="changeSection" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: #d1fae5; border-radius: 8px; border: 2px solid #0f766e;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 700; font-size: 1.2rem; color: #065f46;">
                  <i class="ri-exchange-dollar-line"></i> Kembalian:
                </span>
                <span id="changeAmount" style="font-weight: 800; font-size: 1.5rem; color: #065f46;">Rp 0</span>
              </div>
            </div>

            <button class="btn btn-primary" onclick="checkout()" id="checkoutBtn" style="width: 100%; padding: 1rem; font-size: 1.1rem;" disabled>
              <i class="ri-checkbox-circle-line"></i>
              Proses Pembayaran
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Receipt/Struk Modal (Hidden, untuk print) -->
    <div id="receiptContent" style="display: none;">
      <!-- Struk akan di-generate di sini -->
    </div>

    <!-- Transactions Page -->
    <section class="page" id="page-transactions">
      <!-- Filter Section -->
      <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-body">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <!-- Filter Periode -->
            <div class="form-group">
              <label for="filterPeriod" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                <i class="ri-calendar-line"></i> Periode
              </label>
              <select id="filterPeriod" class="form-select">
                <option value="today">Hari Ini</option>
                <option value="week">Minggu Ini</option>
                <option value="month">Bulan Ini</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <!-- Custom Date Range -->
            <div class="form-group" id="customDateGroup" style="display: none;">
              <label for="filterDateFrom" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                <i class="ri-calendar-check-line"></i> Dari Tanggal
              </label>
              <input type="date" id="filterDateFrom" class="form-input" />
            </div>

            <div class="form-group" id="customDateToGroup" style="display: none;">
              <label for="filterDateTo" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                <i class="ri-calendar-check-line"></i> Sampai Tanggal
              </label>
              <input type="date" id="filterDateTo" class="form-input" />
            </div>

            <!-- Filter Nama Kasir -->
            <div class="form-group">
              <label for="filterCashier" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                <i class="ri-user-line"></i> Nama Kasir
              </label>
              <select id="filterCashier" class="form-select">
                <option value="">Semua Kasir</option>
              </select>
            </div>

            <!-- Filter Kategori -->
            <div class="form-group">
              <label for="filterCategoryTransaction" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                <i class="ri-folder-3-line"></i> Kategori Produk
              </label>
              <select id="filterCategoryTransaction" class="form-select">
                <option value="">Semua Kategori</option>
              </select>
            </div>
          </div>

          <!-- Action Buttons -->
          <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button class="btn btn-primary" onclick="kasirApp.loadTransactions()">
              <i class="ri-search-line"></i> Filter
            </button>
            <button class="btn btn-secondary" onclick="kasirApp.resetTransactionFilters()">
              <i class="ri-refresh-line"></i> Reset
            </button>
            <button class="btn btn-secondary" onclick="kasirApp.loadTransactions()">
              <i class="ri-refresh-line"></i> Refresh
            </button>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 1.5rem;">
        <div class="stat-card">
          <div class="stat-icon blue">
            <i class="ri-file-list-line"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value" id="transactionCount">0</span>
            <span class="stat-label">Total Transaksi</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">
            <i class="ri-money-dollar-circle-line"></i>
          </div>
          <div class="stat-info">
            <span class="stat-value" id="transactionTotal">Rp 0</span>
            <span class="stat-label">Total Penjualan</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3><i class="ri-file-list-line"></i> Riwayat Transaksi</h3>
          <button class="btn btn-primary" onclick="kasirApp.exportTransactions()" id="exportBtn">
            <i class="ri-download-line"></i> Export Excel
          </button>
        </div>
        <div class="card-body no-padding">
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID Transaksi</th>
                  <th>Waktu</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Kasir</th>
                </tr>
              </thead>
              <tbody id="transactionsTableBody">
                <tr>
                  <td colspan="5">
                    <div class="empty-state">
                      <i class="ri-file-list-line"></i>
                      <h3>Belum ada transaksi</h3>
                      <p>Transaksi hari ini akan muncul di sini.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Memuat data...</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/auth.js"></script>
  <!-- Seed data script (untuk setup jika belum ada data) -->
  <script src="js/seed-data.js"></script>
  <script src="js/kasir-app.js"></script>
</body>
</html>
